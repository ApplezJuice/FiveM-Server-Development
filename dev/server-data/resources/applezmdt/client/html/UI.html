<html>
    <head>
    	<meta charset="utf-8">
    	<meta name="viewport" content="width=device-width">
      <link href="style.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
        <style>
			 #general, #topbar, #waiting, #lastNameSearchResults, #personSelected
			 {display: none;}
		</style>
	</head>
    <body>
    	<div class="container">
    		<div id="result"></div>
    		<div class="topbar" id="topbar">
    			<div class="cont-p-1">
    				<div class="parale-1 "></div>
    			</div>
    			<div class="cont-p-2">
    				<div class="parale-2"></div>
    			</div>
    			<div class="cont-p-3">
    				<div class="parale-3"></div>
    			</div>
    			<nav>
    				<div class="logo-topbar"></div>
            <p> Welcome <span class="username1"></span></p>
    				<button class="btn-sign-out"><span>Would you like to disconnect?</span><i class="fas fa-sign-out-alt"></i></button>
    			</nav>
    		</div>
<!-- ########### GENERAL ###########  -->
    		<div class="cont-waiting-two" id="general">
    			<div class="flex">
    				<div class="mdtMainBox box-shadow">
	    				<p>MDT Welcome<br><br>
                <form id="playerSearch">
                  <input id="lastnameSearch" type="text" placeholder="Last Name of Person..">
                  <button class="btn btn-green" type="submit">
                    <span class="fas fa-search icon"></span>
                    <p>Search</p>
                  </button>
                </form>
	    				</p>
		    		</div>
    			</div>
	    	</div>
<!-- ########### LAST NAME SEARCH RESULTS ###########  -->
    		<div class="cont-waiting-two" id="lastNameSearchResults">
    			<div class="flex">
    				<div class="mdtMainBox box-shadow">
	    				<p>MDT User Search Results<br><br>
                <button class="btn btn-grey back">
    					<i class="fas fa-bars"></i>
	    				<span class="fas fa-arrow-left icon"></span>
    				<p>Return</p>
    				    </button>
                <div class="results">
                  <ul id="ulResults">
                  </ul>
                  <!--<ul id="lastNameResults">
                    <li>Test Result</li>
                  </ul>-->
                </div>
	    				</p>
		    		</div>
    			</div>
	    	</div>

        <!-- ########### Person Selected ###########  -->
            		<div class="cont-waiting-two" id="personSelected">
            			<div class="flex">
            				<div class="mdtMainBox box-shadow">
        	    				<p>MDT Person Listed<br><br>
                        <button class="btn btn-grey backToResults">
            					<i class="fas fa-bars"></i>
        	    				<span class="fas fa-arrow-left icon"></span>
            				<p>Return</p>
            				    </button>
                        <div class="thisSelectedPerson">
                          <ul id="ULthisSelectedPerson">
                          </ul>
                          <!--<ul id="lastNameResults">
                            <li>Test Result</li>
                          </ul>-->
                        </div>
        	    				</p>
        		    		</div>
            			</div>
        	    	</div>


<!-- ########### WAITING ###########  -->
	    	<div class="cont-waiting" id="waiting">
	    		<div class="content-waiting">
    				<div class="mainlogo"></div>
    				<p><span>Please</span> connect<br>
    				Scan your <span>fingerprint</span> to confirm identity </p>
    				<div id="fingerprint-content">
    					<div class="fingerprint-default"></div>
    					<div class="fingerprint-active"></div>
    					<div class="fingerprint-bar"></div>
    				</div>
    			</div>
    			<div class="bg-waiting">
    				<div class="cont-p-4">
    					<div class="parale-4"></div>
    				</div>
    				<div class="cont-p-5">
    					<div class="parale-5"></div>
    				</div>
    				<div class="cont-p-6">
    					<div class="parale-6"></div>
    				</div>
    				<div class="cont-p-7">
    					<div class="parale-7"></div>
    				</div>
    			</div>
	    	</div>
    	</div>
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    	<script src="nui://game/ui/jquery.js" type="text/javascript"></script>
    	<script type="text/javascript">

      var thisData = {};

      function addLI(data){
        var ul = document.getElementById("ulResults");
        ul.innerHTML = '';

        for (var i = 0; i < data.length; i++){
          var li = document.createElement("li");
          li.appendChild(document.createTextNode(data[i]['firstname'] + " " + data[i]['lastname'] + " - " + data[i]['dateofbirth']));
          //li.setAttribute("id", i)
          ul.appendChild(li);
        }
      }

      function getPlayerInfo(clickedUser){
        var dataIndex = null;
        for (var i = 0; i < thisData.length; i++){
          var userString = (thisData[i]['firstname'] + " " + thisData[i]['lastname'] + " - " + thisData[i]['dateofbirth']);
          if (userString == clickedUser) {
            dataIndex = i;
            break;
          }
        }

        var ul = document.getElementById("ULthisSelectedPerson");
        ul.innerHTML = '';
        var li = document.createElement("li");

        li.appendChild(document.createTextNode(thisData[dataIndex]['firstname'] + " " + thisData[dataIndex]['lastname']));
        ul.appendChild(li);
        li.appendChild(document.createTextNode(thisData[dataIndex]['dateofbirth']));
        ul.appendChild(li);
        li.appendChild(document.createTextNode(thisData[dataIndex]['sex']));
        ul.appendChild(li);
        li.appendChild(document.createTextNode(thisData[dataIndex]['height']));
        ul.appendChild(li);
        li.appendChild(document.createTextNode(thisData[dataIndex]['job']));
        ul.appendChild(li);
        //alert(thisData[dataIndex]['firstname'] + " " + thisData[dataIndex]['lastname'] + " - " + thisData[dataIndex]['dateofbirth']);
      }

    		$(function() {
				window.addEventListener('message', function(event) {
					if (event.data.type == "openMdt"){
		                $('#waiting').show();
		                $('body').addClass("active");
          } else if (event.data.type == "selfName"){
                    $('.username1').html(event.data.player);
					} else if (event.data.type == "closeAll"){
		                $('#waiting, #general, #topbar, #lastNameSearchResults, #personSelected').hide();
		                $('body').removeClass("active");
					} else if (event.data.type == "nameSearchResults"){
                    var data = event.data.namesearchResult;
                    thisData = data;
                    addLI(data);
                    $('#general').hide();
                    $('#lastNameSearchResults').show();
          }
				});
			});
        $('body').on('click', '#ulResults li', function(){
          var selected = $(this).text();
          getPlayerInfo(selected);
          $('#lastNameSearchResults').hide();
          $('#personSelected').show();
          //alert("List item: " + selected);
        });
    		$('.btn-sign-out').click(function(){
	            $('#general, #waiting, #topbar, #lastNameSearchResults, #personSelected').hide();
	            $('body').removeClass("active");
	            $.post('http://applezmdt/NUIFocusOff', JSON.stringify({}));
	        })
	        $('.back').click(function(){
	            $('#lastNameSearchResults').hide();
	            $('#general').show();
	        })
          $('.backToResults').click(function(){
              $('#personSelected').hide();
	            $('#lastNameSearchResults').show();
	        })
	        $('#fingerprint-content').click(function(){
	            $('.fingerprint-active, .fingerprint-bar').addClass("active")
	            setTimeout(function(){
		  		$('#general').css('display', 'block')
					$('#topbar').css('display', 'flex')
					$('#waiting').css('display', 'none')
					$('.fingerprint-active, .fingerprint-bar').removeClass("active")
				}, 1400);
	        })

          // form id = playerSearch
          $("#playerSearch").submit(function(e) {
		        e.preventDefault(); // Prevent form from submitting
            // posts to client side with a RegisterNUICallback('name', function(data))
		        $.post('http://applezmdt/searchlastname', JSON.stringify({
              // #inputID
		            lastnameSearch: $("#lastnameSearch").val()
		        }));
				$('#general').hide();
				$('#lastNameSearchResults').show();
				$("#lastnameSearch").val('');
			});


			document.onkeyup = function(data){
		        if (data.which == 27){ //escape key
		            $('#general, #waiting, #topbar, #lastNameSearchResults, #personSelected').hide();
		            $('body').removeClass("active");
		            $.post('http://applezmdt/NUIFocusOff', JSON.stringify({}));
		        }
		    }
    	</script>
    </body>
  </html>
